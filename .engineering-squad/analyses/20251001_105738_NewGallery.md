# Code Analysis: NewGallery
Generated: 2025-10-01T10:57:38-04:00

## Files Found
- ./components/NewGallery.tsx

```typescript
'use client';

import { useState, useRef } from 'react';
import { Canvas, useFrame } from '@react-three/fiber';
import { motion, AnimatePresence } from 'framer-motion';
import { Text } from '@react-three/drei';
import * as THREE from 'three';
import { useCollection, type Artwork } from '@/lib/CollectionContext';

const artworks: Artwork[] = [
  { id: 1, title: "Cosmic Birth", category: "painting", size: "72x48", medium: "Acrylic on Canvas", year: 2024, price: "$8,888", description: "The universe's first breath, captured in swirling nebulas of consciousness. Painted during a solar eclipse, this piece channels the raw energy of creation itself.", color: "#9333ea" },
  { id: 2, title: "Digital Ayahuasca", category: "digital", size: "∞x∞", medium: "Generative Algorithm", year: 2024, price: "ETH 1.37", description: "Machine dreams meet plant wisdom in this algorithmic vision quest. Neural networks trained on ancient sacred geometry patterns.", color: "#00ffff" },
  { id: 3, title: "Void Walker", category: "painting", size: "96x72", medium: "Mixed Media", year: 2023, price: "$13,700", description: "A figure traversing the spaces between realities, neither here nor there. Explores the liminal state between dimensions.", color: "#1a0033" },
  { id: 4, title: "Consciousness.exe", category: "installation", size: "Room Scale", medium: "Interactive Projection", year: 2024, price: "Commission", description: "Self-aware code that responds to your thoughts and emotions. Uses EEG sensors to adapt visuals in real-time.", color: "#fbbf24" },
  { id: 5, title: "Astral Projection #7", category: "print", size: "36x24", medium: "Archival Print", year: 2024, price: "$777", description: "The seventh attempt at leaving the body, documented in light. Part of an ongoing series exploring consciousness beyond the physical form.", color: "#6b46c1" },
  { id: 6, title: "Sacred Circuitry", category: "digital", size: "Variable", medium: "AI + Human Collaboration", year: 2024, price: "$3,333", description: "Where ancient symbols meet quantum computing. A synthesis of mystical traditions and cutting-edge technology.", color: "#e9d5ff" },
];

function FloatingArtwork({ artwork, position, index, onClick, isSelected, isChanneled }: {
  artwork: Artwork;
  position: [number, number, number];
  index: number;
  onClick: () => void;
  isSelected: boolean;
  isChanneled: boolean;
}) {
  const meshRef = useRef<THREE.Mesh>(null);
  const [hovered, setHovered] = useState(false);

  useFrame((state) => {
    if (meshRef.current) {
      // Gentle floating animation
      meshRef.current.position.y = position[1] + Math.sin(state.clock.elapsedTime + index) * 0.3;
      // Gentle rotation
      meshRef.current.rotation.y += 0.005;
    }
  });

  return (
    <group position={position}>
      <mesh
        ref={meshRef}
        onClick={(e) => {
          e.stopPropagation();
          onClick();
        }}
        onPointerOver={() => setHovered(true)}
        onPointerOut={() => setHovered(false)}
      >
        <boxGeometry args={[2, 2.5, 0.1]} />
        <meshStandardMaterial
          color={isChanneled ? "#fbbf24" : artwork.color}
          emissive={isChanneled ? "#fbbf24" : artwork.color}
          emissiveIntensity={hovered || isSelected ? 0.8 : isChanneled ? 0.6 : 0.3}
          metalness={0.8}
          roughness={0.2}
        />
      </mesh>

      {/* Title text above artwork */}
      <Text
        position={[0, 1.5, 0.1]}
        fontSize={0.2}
        color="#e9d5ff"
        anchorX="center"
        anchorY="middle"
      >
        {artwork.title}
      </Text>

      {/* Channel indicator */}
      {isChanneled && (
        <mesh position={[0, 0, 0.2]}>
          <torusGeometry args={[1.2, 0.05, 16, 100]} />
          <meshBasicMaterial color="#fbbf24" />
        </mesh>
      )}
    </group>
  );
}

interface NewGalleryProps {
  onArtworkSelect?: (artwork: Artwork) => void;
}

export default function NewGallery({ onArtworkSelect }: NewGalleryProps) {
  const [selectedArtwork, setSelectedArtwork] = useState<Artwork | null>(null);
  const { channelArtwork, isChanneled } = useCollection();

  // Arrange artworks in a circle
  const getArtworkPosition = (index: number): [number, number, number] => {
    const radius = 8;
    const angle = (index / artworks.length) * Math.PI * 2;
    const x = Math.cos(angle) * radius;
    const y = Math.sin(angle) * radius * 0.5;
    const z = Math.sin(index) * 2;
    return [x, y, z];
  };

  const handleArtworkClick = (artwork: Artwork) => {
    setSelectedArtwork(artwork);
    onArtworkSelect?.(artwork);
  };

  const handleChannelArtwork = () => {
    if (selectedArtwork) {
      channelArtwork(selectedArtwork);
      // Optional: close details after channeling
      // setSelectedArtwork(null);
    }
  };

  return (
    <section id="gallery" className="relative min-h-screen py-24" aria-label="Ethereal Gallery - Interactive 3D artwork collection">
      <div className="absolute inset-0">
        <Canvas
          camera={{ position: [0, 0, 15], fov: 75 }}
          gl={{ antialias: true, alpha: true }}
        >
          <ambientLight intensity={0.4} />
          <directionalLight position={[5, 5, 5]} intensity={0.8} color="#9333ea" />
          <pointLight position={[-5, -5, -5]} intensity={0.5} color="#fbbf24" />

          {artworks.map((artwork, index) => (
            <FloatingArtwork
              key={artwork.id}
              artwork={artwork}
              position={getArtworkPosition(index)}
              index={index}
              onClick={() => handleArtworkClick(artwork)}
              isSelected={selectedArtwork?.id === artwork.id}
              isChanneled={isChanneled(artwork.id)}
            />
          ))}

          <fog attach="fog" args={['#0a0a0a', 10, 30]} />
        </Canvas>
      </div>

      {/* Artwork Details Panel */}
      <AnimatePresence>
        {selectedArtwork && (
          <motion.div
            initial={{ opacity: 0, x: 400 }}
            animate={{ opacity: 1, x: 0 }}
            exit={{ opacity: 0, x: 400 }}
            className="fixed right-0 top-0 bottom-0 w-full max-w-md bg-gradient-to-br from-cosmic-nebula/95 to-cosmic-astral/95 backdrop-blur-md border-l border-cosmic-aura z-30 overflow-y-auto"
          >
            <div className="p-8">
              {/* Close button */}
              <button
                onClick={() => setSelectedArtwork(null)}
                className="absolute top-4 right-4 text-cosmic-light hover:text-cosmic-glow text-2xl"
                aria-label="Close details"
              >
                ✕
              </button>

              {/* Artwork preview */}
              <div
                className="w-full h-64 rounded-lg mb-6 flex items-center justify-center"
                style={{
                  backgroundColor: selectedArtwork.color,
                  boxShadow: `0 0 40px ${selectedArtwork.color}`,
                }}
              >
                <div className="text-6xl opacity-50">✦</div>
              </div>

              {/* Details */}
              <h2 className="text-3xl font-bold text-cosmic-glow mb-2">
                {selectedArtwork.title}
              </h2>

              <div className="text-sm text-cosmic-light mb-4 space-y-1">
                <p>{selectedArtwork.medium}</p>
                <p>{selectedArtwork.size} • {selectedArtwork.year}</p>
                <p className="text-mystic-gold font-semibold">{selectedArtwork.price}</p>
              </div>

              <p className="text-cosmic-light mb-6 leading-relaxed">
                {selectedArtwork.description}
              </p>

              {/* Channel button */}
              {isChanneled(selectedArtwork.id) ? (
                <div className="flex items-center gap-2 text-mystic-gold">
                  <span className="text-2xl">✨</span>
                  <span className="font-semibold">Channeled to your collection</span>
                </div>
              ) : (
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={handleChannelArtwork}
                  className="w-full py-4 bg-gradient-to-r from-cosmic-plasma to-cosmic-aura rounded-full text-white font-bold text-lg"
                >
                  ✨ Channel This Piece
                </motion.button>
              )}

              {/* Additional actions */}
              <div className="mt-4 flex gap-2">
                <button className="flex-1 py-2 border border-cosmic-aura/50 rounded-full text-cosmic-light text-sm hover:bg-cosmic-aura/10 transition-colors">
                  View Full Size
                </button>
                <button className="flex-1 py-2 border border-cosmic-aura/50 rounded-full text-cosmic-light text-sm hover:bg-cosmic-aura/10 transition-colors">
                  Order Print
                </button>
              </div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Instructions overlay */}
      <div className="absolute top-8 left-1/2 -translate-x-1/2 z-20 text-center">
        <motion.p
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 1 }}
          className="text-cosmic-light text-sm"
        >
          Click floating artworks to explore • Drag to rotate view
        </motion.p>
      </div>
    </section>
  );
}
```

